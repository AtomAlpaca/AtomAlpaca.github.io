<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Blog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.8.0/tufte.min.css">
    <link rel="stylesheet" href="/assets/tufted.css">
    <link rel="stylesheet" href="/assets/custom.css">
  </head>
  <body>
    <header>
      <nav>
        <div><a href="/">Home</a><a href="/blog/">Blog</a><a href="/friends/">Friends</a><a href="/cv/">CV</a></div>
        <div></div>
        <div></div>
      </nav>
    </header>
    <article>
      <section>
        <p>感觉很好玩记录一下。</p>
        <p>首先将原序列进行分块。块内维护前缀、后缀最大值，对块维护一个 st 表。</p>
        <p>查询的时候在同一个块暴力，不在一个块求左端点所在块一段后缀、右端点所在块一段前缀、中间块在 st 表上的最大值即可。</p>
        <p>块数取 <span role="math"><svg class="typst-frame" style="overflow: visible; width: 1.7054666666666667em; height: 0.7172000000000001em;" viewBox="0 0 18.760133333333332 7.8892" width="18.760133333333332pt" height="7.8892pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:h5="http://www.w3.org/1999/xhtml"><g><g class="typst-text" transform="matrix(1 0 0 -1 6.661966666666667 3.1789999999999994)"><use xlink:href="#gA123E4E6C4366B2C10D77E4EE33522A1" x="0" y="0" fill="#000000" fill-rule="nonzero"/></g><g class="typst-text" transform="matrix(1 0 0 -1 1.1000000000000003 11.308)"><use xlink:href="#g88674E1F438729D9ACA47D5B85286878" x="0" y="0" fill="#000000" fill-rule="nonzero"/><use xlink:href="#gF44C38FB8F8728CB72B9D4AC3AF38059" x="2.1406" y="0" fill="#000000" fill-rule="nonzero"/><use xlink:href="#g750E8E9915B6BB5B0C9ADA1BBBA802D0" x="5.990600000000001" y="0" fill="#000000" fill-rule="nonzero"/></g><g class="typst-text" transform="matrix(1 0 0 -1 12.223933333333335 11.308)"><use xlink:href="#gA123E4E6C4366B2C10D77E4EE33522A1" x="0" y="0" fill="#000000" fill-rule="nonzero"/></g><path class="typst-shape" fill="none" stroke="#000000" stroke-width="0.528" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="4" transform="matrix(1 0 0 1 1.1000000000000003 4.763000000000001)" d="M 0 0h 16.560133 "/></g><defs id="glyph"><symbol id="gA123E4E6C4366B2C10D77E4EE33522A1" overflow="visible"><path d="M 0 0m 1.2628 3.3957 c -0.25409997 0 -0.462 -0.13860011 -0.62369996 -0.42350006 c -0.10780001 -0.19249988 -0.19250003 -0.39269996 -0.24640003 -0.61599994 c -0.023099989 -0.08470011 -0.030799985 -0.1308999 -0.030799985 -0.14630008 c 0 -0.08469987 0.053900003 -0.1308999 0.16169998 -0.1308999 c 0.14630002 0 0.15400004 0.08470011 0.1925 0.24639988 c 0.13090003 0.53130007 0.30799997 0.8008001 0.53130007 0.8008001 c 0.14629996 0 0.2155999 -0.11549997 0.2155999 -0.34649992 c 0 -0.08470011 -0.03849995 -0.28489995 -0.12319994 -0.61599994 l -0.4081 -1.6478001 c -0.053900003 -0.20790002 -0.07700002 -0.31570002 -0.07700002 -0.32340002 c 0 -0.1771 0.10010004 -0.2695 0.29260004 -0.2695 c 0.14629996 0 0.25409997 0.0616 0.32340002 0.1848 c 0.023100019 0.0462 0.06929994 0.20789999 0.13859999 0.4774 l 0.16170001 0.67759997 c 0.092399955 0.36189997 0.14629996 0.56210005 0.16170001 0.6083 c 0.06159997 0.20020008 0.15399992 0.39269996 0.28489983 0.56980014 c 0.32340002 0.45429993 0.6930001 0.6852999 1.1165001 0.6852999 c 0.27719998 0 0.41579986 -0.16939998 0.41579986 -0.50049996 c 0 -0.30030012 -0.14629984 -0.83159995 -0.44659996 -1.6016 c -0.0769999 -0.20019996 -0.11549997 -0.33879995 -0.11549997 -0.42349994 c 0 -0.4158 0.33879995 -0.6776 0.75460005 -0.6776 c 0.36189985 0 0.6545 0.1848 0.86240005 0.5544 c 0.1770997 0.3157 0.2617998 0.52360004 0.2617998 0.6313999 c 0 0.08470011 -0.053899765 0.13090003 -0.1539998 0.13090003 c -0.05390024 -0.0076999664 -0.10780001 -0.046199918 -0.16170025 -0.12319994 c -0.0076999664 -0.0077000856 -0.0076999664 -0.023100019 -0.0076999664 -0.030799985 c -0.1770997 -0.59290004 -0.4389 -0.89320004 -0.77769995 -0.89320004 c -0.10780001 0 -0.16170001 0.07699999 -0.16170001 0.2387 c 0 0.10779998 0.06160021 0.308 0.17710018 0.6006 c 0.26950002 0.6853 0.40039992 1.1780999 0.40039992 1.4707 c 0 0.3541999 -0.12319994 0.6006 -0.36189985 0.7314999 c -0.19250011 0.10780001 -0.4158001 0.16170001 -0.65450025 0.16170001 c -0.50049996 0 -0.9239998 -0.21560001 -1.2628 -0.64680004 c -0.06929994 0.37730002 -0.40039992 0.64680004 -0.8392999 0.64680004 Z "/></symbol><symbol id="g88674E1F438729D9ACA47D5B85286878" overflow="visible"><path d="M 0 0m 1.1087999 0.0231 l 0.8547001 -0.0231 v 0.3003 c -0.27719998 0 -0.44660008 0.0076999962 -0.5005001 0.03850001 c -0.053900003 0.030799985 -0.0769999 0.1232 -0.0769999 0.26949996 v 4.7355003 l -1.1319001 -0.08470011 v -0.29260015 c 0.2695 0 0.43890002 -0.0230999 0.49280003 -0.0692997 c 0.053899944 -0.046200275 0.08469999 -0.15400028 0.08469999 -0.3311 v -3.9578001 c 0 -0.14629996 -0.023100019 -0.23869997 -0.07700002 -0.26949996 c -0.053900003 -0.030800015 -0.22329998 -0.03850001 -0.50049996 -0.03850001 v -0.3003 Z "/></symbol><symbol id="gF44C38FB8F8728CB72B9D4AC3AF38059" overflow="visible"><path d="M 0 0m 1.9173 -0.0847 c 0.47740006 0 0.8778 0.1694 1.2089 0.5082 c 0.3311 0.3388 0.50049996 0.7469 0.50049996 1.2242999 c 0 0.48510003 -0.16170001 0.9086001 -0.48510003 1.2628 c -0.32340002 0.35420012 -0.7314999 0.53900003 -1.2166 0.53900003 c -0.4850999 0 -0.88549995 -0.18479991 -1.2166 -0.53900003 c -0.33110002 -0.3541999 -0.4928 -0.77769995 -0.4928 -1.2628 c 0 -0.47739995 0.1617 -0.88549995 0.4928 -1.2242999 c 0.3311 -0.3388 0.7392 -0.5082 1.2089 -0.5082 Z m 0.0076999664 0.2464 c -0.36959994 0 -0.6467999 0.1617 -0.8392999 0.4928 c -0.12320006 0.21560001 -0.18480003 0.5698 -0.18480003 1.0548999 c 0 0.4697001 0.06159997 0.80850005 0.17709994 1.0241001 c 0.18480003 0.3311 0.462 0.4928 0.83930004 0.4928 c 0.3619001 0 0.6391001 -0.16170001 0.83159995 -0.47740006 c 0.13090014 -0.21560001 0.19250011 -0.56209993 0.19250011 -1.0395 c 0 -0.8931999 -0.26180005 -1.5476999 -1.0164001 -1.5476999 Z "/></symbol><symbol id="g750E8E9915B6BB5B0C9ADA1BBBA802D0" overflow="visible"><path d="M 0 0m 3.3187 3.4881 c -0.29260015 0 -0.5621002 -0.11549997 -0.80850005 -0.34650016 c -0.23099995 0.17710018 -0.4928 0.26180005 -0.7931 0.26180005 c -0.6622 0 -1.2628 -0.4928 -1.2628 -1.1396 c 0 -0.3233999 0.11550003 -0.58519995 0.34649998 -0.7853999 c -0.14629996 -0.18480003 -0.22329998 -0.39269996 -0.22329998 -0.6314 c 0 -0.29260004 0.10010004 -0.5159 0.29260004 -0.6622 c -0.32340002 -0.1078 -0.6545 -0.385 -0.6545 -0.77769995 c 0 -0.33110005 0.2156 -0.5929 0.63909996 -0.7777 c 0.32340002 -0.14629996 0.6776 -0.21560001 1.0626 -0.21560001 c 0.39269996 0 0.75460005 0.069300056 1.0780001 0.21560001 c 0.42349982 0.18480003 0.63139987 0.44659996 0.63139987 0.7931 c 0 0.40809998 -0.16939998 0.7084 -0.50819993 0.9009 c -0.35420012 0.19250003 -0.7469001 0.21559998 -1.3167 0.21559998 c -0.33880007 0 -0.5236 0 -0.56210005 0.007700026 c -0.21560001 0.030799985 -0.36959994 0.23869997 -0.36959994 0.47739995 c 0 0.11550009 0.030799985 0.2233001 0.10009998 0.31570005 c 0.21559995 -0.14629996 0.46199995 -0.22329998 0.7469 -0.22329998 c 0.66219985 0 1.2550999 0.4928 1.2550999 1.1395999 c 0 0.30030012 -0.10010004 0.5467 -0.30029988 0.7392001 c 0.19249988 0.17709994 0.40039992 0.2617998 0.6236999 0.2617998 c -0.03850007 -0.038499832 -0.06159997 -0.1000998 -0.06159997 -0.17709994 c 0 -0.16939998 0.08470011 -0.25409985 0.25410008 -0.25409985 c 0.16170001 0 0.24639988 0.08469987 0.24639988 0.2617998 c 0 0.23870015 -0.18479991 0.40040016 -0.41579986 0.40040016 Z m -1.6016 -0.32340002 c 0.41579998 0 0.6237 -0.30030012 0.6237 -0.9009001 c 0 -0.6083 -0.20790005 -0.91629994 -0.6237 -0.91629994 c -0.42350006 0 -0.6314 0.3003 -0.6314 0.9086 c 0 0.6083 0.20789993 0.9086001 0.6314 0.9086001 Z m -0.45430005 -3.1339 h 0.44659996 c 0.40040016 0 0.72379994 -0.0231 0.97020006 -0.077 c 0.3311 -0.0693 0.4928 -0.2541 0.4928 -0.5467 c 0 -0.2464 -0.15400004 -0.43890005 -0.4619999 -0.5852 c -0.23870015 -0.11549997 -0.5005002 -0.16939998 -0.78540015 -0.16939998 c -0.27719998 0 -0.5389999 0.053900003 -0.7853999 0.16939998 c -0.31570005 0.14629996 -0.46970004 0.3388 -0.46970004 0.5852 c 0 0.3234 0.27719998 0.62369996 0.5929 0.62369996 Z "/></symbol></defs></svg></span> 预处理就能做到 <span role="math"><svg class="typst-frame" style="overflow: visible; width: 2.146em; height: 0.683em;" viewBox="0 0 23.606 7.513000000000001" width="23.606pt" height="7.513000000000001pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:h5="http://www.w3.org/1999/xhtml"><g><g class="typst-text" transform="matrix(1 0 0 -1 0 7.513000000000001)"><use xlink:href="#g74AB2B8733BD379A524D571A269A264D" x="0" y="0" fill="#000000" fill-rule="nonzero"/></g><g class="typst-text" transform="matrix(1 0 0 -1 8.448 7.513000000000001)"><use xlink:href="#g5B43DD4F7F87BE419C28A94CEF93C064" x="0" y="0" fill="#000000" fill-rule="nonzero"/></g><g class="typst-text" transform="matrix(1 0 0 -1 12.727 7.513000000000001)"><use xlink:href="#g1B183B14B2DCB4AB6A3212F8517A6B72" x="0" y="0" fill="#000000" fill-rule="nonzero"/></g><g class="typst-text" transform="matrix(1 0 0 -1 19.327 7.513000000000001)"><use xlink:href="#g828A4F8A2DF99085B64FBE29D9963F29" x="0" y="0" fill="#000000" fill-rule="nonzero"/></g></g><defs id="glyph"><symbol id="g74AB2B8733BD379A524D571A269A264D" overflow="visible"><path d="M 0 0m 7.722 2.893 c 0.27499962 0.6270001 0.41800022 1.254 0.41800022 1.892 c 0 0.8580003 -0.25300026 1.5620003 -0.77000046 2.1230001 c -0.5169997 0.5609999 -1.1989999 0.8470001 -2.046 0.8470001 c -0.5829997 0 -1.1659999 -0.14300013 -1.7489998 -0.42900038 c -1.188 -0.5829997 -2.0570002 -1.507 -2.618 -2.7609997 c -0.27500004 -0.6160002 -0.41800004 -1.2320001 -0.41800004 -1.859 c 0 -0.8690001 0.25300002 -1.5730001 0.77000004 -2.1230001 c 0.51699996 -0.55 1.1989999 -0.825 2.057 -0.825 c 0.572 0 1.1439998 0.143 1.727 0.41799998 c 1.1989999 0.583 2.0679998 1.4959999 2.6290002 2.717 Z m -0.638 2.3209999 c 0 -1.4629998 -0.6600003 -2.9259996 -1.3640003 -3.7949996 c -0.48399973 -0.605 -1.3199997 -1.2870001 -2.2879999 -1.2870001 c -1.177 0 -1.793 1.023 -1.793 2.266 c 0 0.385 0.07700002 0.90199995 0.22000003 1.529 c 0.29699993 1.2979999 1.0450001 2.442 2.024 3.0359998 c 0.47300005 0.28600025 0.93499994 0.42900038 1.375 0.42900038 c 1.1880002 0 1.8260002 -0.9460001 1.8260002 -2.1780005 Z "/></symbol><symbol id="g5B43DD4F7F87BE419C28A94CEF93C064" overflow="visible"><path d="M 0 0m 3.498 -2.728 c 0.09899998 0 0.15400004 0.05499983 0.15400004 0.15400004 c 0 0.032999992 -0.022000074 0.0769999 -0.055000067 0.12099981 c -0.5719998 0.44000006 -1.0339999 1.1660001 -1.375 2.167 c -0.29699993 0.869 -0.45099986 1.727 -0.45099986 2.5740001 v 0.9239998 c 0 0.8470001 0.15399992 1.7049999 0.45099986 2.574 c 0.34100008 1.0010004 0.8030002 1.7270002 1.375 2.1670003 c 0.032999992 0.032999992 0.055000067 0.076999664 0.055000067 0.12100029 c 0 0.09899998 -0.055000067 0.15399933 -0.15400004 0.15399933 c -0.010999918 0 -0.04399991 -0.01099968 -0.0769999 -0.032999992 c -0.6600001 -0.50599957 -1.21 -1.2539997 -1.661 -2.2549996 c -0.42900002 -0.95700026 -0.64900005 -1.8590002 -0.64900005 -2.7280002 v -0.9239998 c 0 -0.8690001 0.22000003 -1.7710001 0.64900005 -2.7280002 c 0.45099998 -1.0009999 1.0009999 -1.7489998 1.661 -2.2549999 c 0.032999992 -0.022000074 0.065999985 -0.032999992 0.0769999 -0.032999992 Z "/></symbol><symbol id="g1B183B14B2DCB4AB6A3212F8517A6B72" overflow="visible"><path d="M 0 0m 5.907 1.507 c -0.25300026 -0.86899996 -0.6160002 -1.309 -1.0669999 -1.309 c -0.14300013 0 -0.22000027 0.11 -0.22000027 0.319 c 0 0.15399998 0.065999985 0.407 0.19799995 0.74799997 c 0.44000006 1.199 0.6600003 1.991 0.6600003 2.3979998 c 0 0.7700002 -0.5170002 1.1990001 -1.2870002 1.1990001 c -0.6489999 0 -1.21 -0.28599977 -1.661 -0.86899996 c -0.08800006 0.48399973 -0.47300005 0.86899996 -1.0339999 0.86899996 c -0.61600006 0 -0.85800004 -0.572 -1.0120001 -1.0669999 c -0.109999985 -0.352 -0.16499999 -0.5610001 -0.16499999 -0.638 c 0 -0.09899998 0.055000007 -0.15400004 0.176 -0.15400004 c 0.055000007 0 0.088 0.010999918 0.12099999 0.032999992 c 0.055000007 0.09899998 0.088 0.17599988 0.09899998 0.25300002 c 0.19800001 0.83599997 0.45100003 1.2539997 0.74799997 1.2539997 c 0.19800007 0 0.29700005 -0.1539998 0.29700005 -0.4619999 c 0 -0.14299989 -0.054999948 -0.43999982 -0.176 -0.8909998 l -0.627 -2.497 c -0.032999992 -0.143 -0.09900004 -0.42900002 -0.09900004 -0.48400003 c 0 -0.22 0.12099999 -0.32999998 0.36299998 -0.32999998 c 0.20899999 0 0.36300004 0.11 0.44000006 0.32999998 c 0.021999955 0.055000007 0.08799994 0.32999998 0.20899999 0.803 l 0.23100007 0.979 l 0.32999992 1.254 c 0.12100005 0.25300002 0.3080001 0.50600004 0.53900003 0.77 c 0.319 0.35200024 0.7149999 0.5279999 1.188 0.5279999 c 0.36299992 0 0.53900003 -0.24199963 0.53900003 -0.7149997 c 0 -0.41799998 -0.23099995 -1.2540002 -0.704 -2.5080001 c -0.07700014 -0.19799995 -0.11000013 -0.36299992 -0.11000013 -0.5059999 c 0 -0.53900003 0.40700006 -0.935 0.93499994 -0.935 c 0.4840002 0 0.86899996 0.275 1.144 0.825 c 0.20900011 0.44000006 0.31900024 0.737 0.31900024 0.88 c 0 0.09899998 -0.055000305 0.15400004 -0.17600012 0.15400004 c -0.032999992 0 -0.19799995 -0.0990001 -0.19799995 -0.23100007 Z "/></symbol><symbol id="g828A4F8A2DF99085B64FBE29D9963F29" overflow="visible"><path d="M 0 0m 0.858 -2.695 c 0.66 0.50600004 1.21 1.254 1.661 2.2549999 c 0.4289999 0.957 0.6489999 1.859 0.6489999 2.7280002 v 0.9239998 c 0 0.86899996 -0.22000003 1.7709999 -0.6489999 2.7280002 c -0.45099998 1.0009999 -1.001 1.7490001 -1.661 2.2549996 c -0.032999992 0.022000313 -0.065999985 0.032999992 -0.07699996 0.032999992 c -0.09900004 0 -0.15400004 -0.05499935 -0.15400004 -0.15399933 c 0 -0.044000626 0.022000015 -0.0880003 0.055000007 -0.12100029 c 0.57199997 -0.44000006 1.0339999 -1.1659999 1.375 -2.1670003 c 0.29700017 -0.86899996 0.45099998 -1.7269998 0.45099998 -2.574 v -0.9239998 c 0 -0.8470001 -0.1539998 -1.7050002 -0.45099998 -2.5740001 c -0.34099996 -1.0009999 -0.803 -1.727 -1.375 -2.167 c -0.032999992 -0.04399991 -0.055000007 -0.08799982 -0.055000007 -0.12099981 c 0 -0.099000216 0.055000007 -0.15400004 0.15400004 -0.15400004 c 0.010999978 0 0.04399997 0.010999918 0.07699996 0.032999992 Z "/></symbol></defs></svg></span> 了。但是因为 st 表常数略大块数要适当取少几倍。</p>
        <p>扔个代码。</p>
        <pre><code>#include &lt;bits/stdc++.h><br><br>namespace GenHelper<br>{<br>    unsigned z1,z2,z3,z4,b;<br>    unsigned rand_()<br>    {<br>        b=((z1&lt;&lt;6)^z1)>>13;<br>        z1=((z1&amp;4294967294U)&lt;&lt;18)^b;<br>        b=((z2&lt;&lt;2)^z2)>>27;<br>        z2=((z2&amp;4294967288U)&lt;&lt;2)^b;<br>        b=((z3&lt;&lt;13)^z3)>>21;<br>        z3=((z3&amp;4294967280U)&lt;&lt;7)^b;<br>        b=((z4&lt;&lt;3)^z4)>>12;<br>        z4=((z4&amp;4294967168U)&lt;&lt;13)^b;<br>        return (z1^z2^z3^z4);<br>    }<br>}<br>void srand(unsigned x)<br>{using namespace GenHelper;<br>    z1=x; z2=(~x)^0x233333333U; z3=x^0x1234598766U; z4=(~x)+51;}<br>int read()<br>{<br>    using namespace GenHelper;<br>    int a=rand_()&amp;32767;<br>    int b=rand_()&amp;32767;<br>    return a*32768+b;<br>}<br>const int MAX = 2e7 + 5;<br>const int MAXX = 1e6 + 5;<br>const int MAXXX = 25;<br><br>int n, m, s, sz, l, r;<br>int a[MAX], bl[MAX], lg[MAX], st[MAXX], ed[MAXX], lm[MAX], rm[MAX], mx[MAXXX][MAXX];<br>unsigned long long ans;<br>inline void init()<br>{<br>    for (int i = 2; i &lt;= sz; ++i) { lg[i] = lg[i >> 1] + 1; }<br>    for (int i = 1; i &lt;= sz; ++i) { st[i] = (n / sz) * (i - 1) + 1; ed[i] = (n / sz) * i; } ed[sz] = n;<br>    for (int i = 1; i &lt;= sz; ++i) { for (int j = st[i]; j &lt;= ed[i]; ++j) { bl[j] = i; } }<br>    for (int i = 1; i &lt;= sz; ++i) { for (int j = ed[i]; j >= st[i]; --j) { rm[j] = std::max(rm[j + 1], a[j]); } }<br>    for (int i = sz; i >= 1; --i) { for (int j = st[i]; j &lt;= ed[i]; ++j) { lm[j] = std::max(lm[j - 1], a[j]); } }<br>    for (int i = 1; i &lt;= sz; ++i) { mx[0][i] = rm[st[i]]; }<br>    for (int i = 1; (1 &lt;&lt; i) &lt;= sz; ++i)<br>    {<br>        for (int j = 1; j + (1 &lt;&lt; i) - 1 &lt;= sz; ++j) { mx[i][j] = std::max(mx[i - 1][j], mx[i - 1][j + (1 &lt;&lt; (i - 1))]); }<br>    }<br>}<br><br>inline int qry(int l, int r)<br>{<br>    int res = 0, L = bl[l], R = bl[r];<br>    if (L + 1 &lt; R)<br>    {<br>        int LG = lg[--R - ++L + 1];<br>        return std::max(std::max(lm[r], rm[l]), std::max(mx[LG][L], mx[LG][R - (1 &lt;&lt; LG) + 1]));<br>    }<br>    else if (L + 1 == R) { return std::max(lm[r], rm[l]); }<br>    else { for (int i = l; i &lt;= r; ++i) { res = std::max(res, a[i]); } return res; }<br>}<br><br>int main()<br>{<br>    scanf("%d%d%d", &amp;n, &amp;m, &amp;s); srand(s); sz = n / (16 * log2(n));<br>    for (int i = 1; i &lt;= n; ++i) { a[i] = read(); } init();<br>    for (int i = 1; i &lt;= m; ++i) { l = read() % n + 1; r = read() % n + 1; if (l > r) { std::swap(l, r); } ans += qry(l, r); }<br>    printf("%lld", ans);<br>    return 0;<br>}</code></pre>
      </section>
    </article>
  </body>
</html>
